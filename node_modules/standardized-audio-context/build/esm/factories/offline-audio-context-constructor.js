import * as tslib_1 from "tslib";
import { wrapAudioBufferCopyChannelMethods } from '../wrappers/audio-buffer-copy-channel-methods';
var DEFAULT_OPTIONS = {
    numberOfChannels: 1
};
export var createOfflineAudioContextConstructor = function (baseAudioContextConstructor, nativeOfflineAudioContextConstructor, startRendering) {
    return /** @class */ (function (_super) {
        tslib_1.__extends(OfflineAudioContext, _super);
        function OfflineAudioContext(a, b, c) {
            var _this = this;
            if (nativeOfflineAudioContextConstructor === null) {
                throw new Error(); // @todo
            }
            var options;
            if (typeof a === 'number' && b !== undefined && c !== undefined) {
                options = { length: b, numberOfChannels: a, sampleRate: c };
            }
            else if (typeof a === 'object') {
                options = a;
            }
            else {
                throw new Error('The given parameters are not valid.');
            }
            var _a = tslib_1.__assign({}, DEFAULT_OPTIONS, options), length = _a.length, numberOfChannels = _a.numberOfChannels, sampleRate = _a.sampleRate;
            var nativeOfflineAudioContext = new nativeOfflineAudioContextConstructor(numberOfChannels, length, sampleRate);
            _this = _super.call(this, nativeOfflineAudioContext, numberOfChannels) || this;
            _this._length = length;
            _this._nativeOfflineAudioContext = nativeOfflineAudioContext;
            return _this;
        }
        Object.defineProperty(OfflineAudioContext.prototype, "length", {
            get: function () {
                // Bug #17: Safari does not yet expose the length.
                if (this._nativeOfflineAudioContext.length === undefined) {
                    return this._length;
                }
                return this._nativeOfflineAudioContext.length;
            },
            enumerable: true,
            configurable: true
        });
        OfflineAudioContext.prototype.startRendering = function () {
            return startRendering(this.destination, this._nativeOfflineAudioContext)
                .then(function (audioBuffer) {
                // Bug #5: Safari does not support copyFromChannel() and copyToChannel().
                if (typeof audioBuffer.copyFromChannel !== 'function') {
                    wrapAudioBufferCopyChannelMethods(audioBuffer);
                }
                return audioBuffer;
            });
        };
        return OfflineAudioContext;
    }(baseAudioContextConstructor));
};
//# sourceMappingURL=/build/es2015/factories/offline-audio-context-constructor.js.map