import { wrapAudioBufferCopyChannelMethods } from '../wrappers/audio-buffer-copy-channel-methods';
const DEFAULT_OPTIONS = {
    numberOfChannels: 1
};
export const createMinimalOfflineAudioContextConstructor = (minimalBaseAudioContextConstructor, nativeOfflineAudioContextConstructor, startRendering) => {
    return class MinimalOfflineAudioContext extends minimalBaseAudioContextConstructor {
        constructor(options) {
            if (nativeOfflineAudioContextConstructor === null) {
                throw new Error(); // @todo
            }
            const { length, numberOfChannels, sampleRate } = Object.assign({}, DEFAULT_OPTIONS, options);
            const nativeOfflineAudioContext = new nativeOfflineAudioContextConstructor(numberOfChannels, length, sampleRate);
            super(nativeOfflineAudioContext, numberOfChannels);
            this._length = length;
            this._nativeOfflineAudioContext = nativeOfflineAudioContext;
        }
        get length() {
            // Bug #17: Safari does not yet expose the length.
            if (this._nativeOfflineAudioContext.length === undefined) {
                return this._length;
            }
            return this._nativeOfflineAudioContext.length;
        }
        startRendering() {
            return startRendering(this.destination, this._nativeOfflineAudioContext)
                .then((audioBuffer) => {
                // Bug #5: Safari does not support copyFromChannel() and copyToChannel().
                if (typeof audioBuffer.copyFromChannel !== 'function') {
                    wrapAudioBufferCopyChannelMethods(audioBuffer);
                }
                return audioBuffer;
            });
        }
    };
};
//# sourceMappingURL=/build/es2015/factories/minimal-offline-audio-context-constructor.js.map